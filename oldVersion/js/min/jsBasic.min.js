function bulletEmmisionFunct(){playerAlive&&(firing&&(firingCooldownTotal=firingCooldown*dilationFactor,currBullets>0&&(makeBullet(1),currBullets=0),1>currBullets&&counter-firingTime>=firingCooldownTotal&&(currBullets++,firingTime=counter)),0==firing&&(firingTime=0,currBullets=1))}function makeBullet(e){for(var l=0;e>l;l++){var r={x:p.x,y:p.y,xVel:aimXVel,yVel:aimYVel,r:3};bullets.push(r)}}function bulletUpdater(){for(var e=bullets.length-1;e>=0;e--){var l=bullets[e];c.fillStyle="white",c.fillCircle(l.x,l.y,l.r),l.x+=l.xVel/dilationFactor,l.y+=l.yVel/dilationFactor,(l.x>canvas.width||l.x<0||l.y>canvas.height||l.y<0)&&bullets.splice(e,1)}}function gameState(){switch(currGameState){case"firstLoad":break;case"gameMenu":break;case"gameIntro":break;case"levelIntro":break;case"gamePlay":break;case"levelOutro":break;case"gameWin":break;case"gameLose":break;case"gameOutro":}}function draw(){frameRate=60,c.globalCompositeOperation="source-over",c.clearRect(0,0,canvas.width,canvas.height),startGame&&(populateAsteroids&&(10>asteroidsL?(makeAsteroidL(10),populateAsteroids=!1):makeAsteroidL(0)),20==gameTime&&1>currPowerUps&&(currPowerUps=1,powerUpThisTime=counter),1==currPowerUps&&powerUps.length<1&&(makePowerUp(1),currPowerUps--),dilationSwitch&&(4>dilationFactor&&(dilationFactor+=.5),dilationAmount>0&&(dilationAmount-=1),0==dilationAmount&&(dilationSwitch=!1)),dilationSwitch||dilationFactor>1&&(dilationFactor-=.5),playerAimRender(),asteroidLargeUpdater(),asteroidSmallUpdater(),explosionsUpdater(),bulletUpdater(),powerUpUpdater(),scoreTextUpdater(),bulletEmmisionFunct(),playerRender(),playerUpdate(),playerControls()),gameOverAnim(),counter++,debugOutput()}function randomPopulate(){var e=random(-50,canvas.width+50),l=random(-50,canvas.height+50),r=random(0,4);1>r?(resultX=-50,resultY=parseInt(l,10)):r>1&&2>r?(resultX=parseInt(e,10),resultY=-50):r>2&&3>r?(resultX=canvas.width+50,resultY=parseInt(l,10)):r>3&&(resultX=parseInt(e,10),resultY=canvas.height+50)}function makeAsteroidL(e){for(var l=0;e>l;l++){randomPopulate();var r={x:resultX,y:resultY,xVel:random(-2,2),yVel:random(-2,2),score:100,r:50};asteroidsL.push(r)}}function asteroidLargeUpdater(){c.fillStyle=rgb(150,150,255);for(var e=asteroidsL.length-1;e>=0;e--){var l=asteroidsL[e];c.fillCircle(l.x,l.y,l.r),l.x+=l.xVel/dilationFactor,l.y+=l.yVel/dilationFactor,l.x>canvas.width+l.r&&(l.x=0-l.r),l.x<0-l.r&&l.xVel<0&&(l.x=canvas.width+l.r),l.y>canvas.height+l.r&&(l.y=0-l.r),l.y<0-l.r&&l.yVel<0&&(l.y=canvas.height+l.r);for(var r=bullets.length-1;r>=0;r--){var o=bullets[r],a=dist(o.x,o.y,l.x,l.y),t=o.r+l.r;if(t>=a){colPointX=l.x,colPointY=l.y;var i=l.score*scoreMultiplier;score+=i,dilationAmount+=10,makeScoreText(1,i),makeAsteroidS(10),makeExplosions(1),bullets.splice(r,1),asteroidsL.splice(e,1),multiplierTarget>0&&multiplierTarget--,0==multiplierTarget&&(scoreMultiplier+=1,multiplierTarget=10)}}}}function makeAsteroidS(e){for(var l=0;e>l;l++){var r={x:colPointX,y:colPointY,xVel:random(-2,2),yVel:random(-2,2),score:200,r:10};asteroidsS.push(r)}}function asteroidSmallUpdater(){for(var e=asteroidsS.length-1;e>=0;e--){var l=asteroidsS[e];c.fillCircle(l.x,l.y,l.r),l.x+=l.xVel/dilationFactor,l.y+=l.yVel/dilationFactor,l.x>canvas.width+l.r&&(l.x=0-l.r),l.x<0-l.r&&l.xVel<0&&(l.x=canvas.width+l.r),l.y>canvas.height+l.r&&(l.y=0-l.r),l.y<0-l.r&&l.yVel<0&&(l.y=canvas.height+l.r);for(var r=bullets.length-1;r>=0;r--){var o=bullets[r],a=dist(o.x,o.y,l.x,l.y),t=o.r+l.r;if(t>=a){colPointX=l.x,colPointY=l.y,makeExplosions(1),dilationAmount+=20;var i=l.score*scoreMultiplier;score+=i,makeScoreText(1,i),bullets.splice(r,1),asteroidsS.splice(e,1),multiplierTarget>0&&multiplierTarget--,0==multiplierTarget&&(scoreMultiplier+=1,multiplierTarget=10)}}}}function makePowerUp(e){for(var l=0;e>l;l++){var r={x:random(0,canvas.width),y:random(0,canvas.height),xVel:random(-2,2),yVel:random(-2,2),r:20,colR:0,colG:255,colB:0,colA:1};powerUps.push(r)}}function powerUpUpdater(){for(var e=powerUps.length-1;e>=0;e--){var l=powerUps[e];c.fillStyle=rgb(l.colR,l.colG,l.colB,l.colA),c.fillCircle(l.x,l.y,l.r);var r=dist(p.x,p.y,l.x,l.y),o=p.r+l.r;l.x+=l.xVel/dilationFactor,l.y+=l.yVel/dilationFactor,o>=r&&(colPointX=l.x,colPointY=l.y,makeExplosions(1),powerUps.splice(e,1),10==firingCooldown&&(firingCooldown=7,bulletSpeed=25)),l.x>canvas.width+l.r&&(l.x=0-l.r),l.x<0-l.r&&l.xVel<0&&(l.x=canvas.width+l.r),l.y>canvas.height+l.r&&(l.y=0-l.r),l.y<0-l.r&&l.yVel<0&&(l.y=canvas.height+l.r)}}function makeScoreText(e,l){for(var r=0;e>r;r++){var o={x:colPointX,y:colPointY,thisScore:l,colR:100,colG:100,colB:255,colA:1};scoreText.push(o)}}function scoreTextUpdater(){for(var e=scoreText.length-1;e>=0;e--){var l=scoreText[e];c.fillStyle=rgba(l.colR,l.colG,l.colB,l.colA),c.font="20pt arial",c.fillStyle="#ccc",c.fillText(l.thisScore,l.x,l.y),l.colR-=2,l.colG-=2,l.colA-=.05,l.y-=1,l.colA<=.05&&scoreText.splice(e,1)}}function makeExplosions(e){for(var l=0;e>l;l++){var r={x:colPointX,y:colPointY,colR:255,colG:255,colB:255,colA:1,line:20,r:10};explosions.push(r)}}function explosionsUpdater(){for(var e=explosions.length-1;e>=0;e--){var l=explosions[e];c.lineWidth=l.line,c.strokeStyle=rgba(l.colR,l.colG,l.colB,l.colA),c.strokeCircle(l.x,l.y,l.r),c.strokeCircle(l.x,l.y,.25*l.r),l.colG-=10/dilationFactor,l.colB-=10/dilationFactor,l.colA-=.05/dilationFactor,l.r+=25/dilationFactor,l.line-=2,l.colA<=.05&&explosions.splice(e,1)}}function makeStars(e){for(var l=0;e>l;l++){var r={x:random(0,canvas.width),y:random(0,canvas.height),colR:255,colG:255,colB:255,r:random(.5,1)};bgStars.push(r)}}function starsRenderer(){for(var e=bgStars.length-1;e>=0;e--){var l=bgStars[e];c.fillStyle=rgb(l.colR,l.colG,l.colB),c.fillCircle(l.x,l.y,l.r)}}var canvas=document.getElementById("myCanvas"),c=canvas.getContext("2d");canvas.width=window.innerWidth,canvas.height=window.innerHeight;var counter=0,score=0,scoreMultiplier=1,multiplierTarget=10,startGame=!1,gameOver=!1,populateAsteroids=!0,playerAlive=!0,playerCollision=!1,playerLives=3,powerUpTimer=1200,powerUpThisTime=0,powerUpTimerSet=!1,currPowerUps=0,gameTime,dilationFactor=1,dilationAmount=0,dilationSwitch=!1,dilationSwitchCheck=!0,player={x:canvas.width/2,y:canvas.height/2,r:20,colR:150,colG:150,colB:150,xVel:0,yVel:0},firing=!1,firingTime=0,firingCooldown=10,firingCooldownTotal,currBullets=1,bulletSpeed=20,colPointX=0,colPointY=0,p=player,aimDeltaX,aimDeltaY,aimAngle,aimXVel,aimYVel,aimCalculation=function(){aimDeltaX=mouseX-p.x,aimDeltaY=mouseY-p.y,aimAngle=Math.atan2(aimDeltaY,aimDeltaX),aimXVel=Math.cos(aimAngle)*bulletSpeed,aimYVel=Math.sin(aimAngle)*bulletSpeed},playerRender=function(){playerAlive&&((playerLeftKey||playerRightKey)&&boosterXRender(),(playerUpKey||playerDownKey)&&boosterYRender(),c.fillStyle=rgb(p.colR,p.colG,p.colB),c.fillCircle(p.x,p.y,p.r),c.lineWidth=4,aimCalculation(),c.strokeStyle=rgb(200,0,0),c.save(),c.translate(p.x,p.y),c.rotate(aimAngle),c.beginPath(),c.moveTo(0,0),c.lineTo(20,0),c.stroke(),c.restore())},boosterXRender=function(){var e=random(50,150);if(c.globalCompositeOperation="lighter",playerLeftKey){var l=c.createLinearGradient(p.x,p.y-10,p.x+e,p.y+10);l.addColorStop(0,"rgba(255,255,255,1)"),l.addColorStop(1,"rgba(0,0,255,0)"),c.fillStyle=l,c.fillRect(p.x,p.y-10,e,20)}if(playerRightKey){var l=c.createLinearGradient(p.x,p.y-10,p.x-e,p.y+10);l.addColorStop(0,"rgba(255,255,255,1)"),l.addColorStop(1,"rgba(0,0,255,0)"),c.fillStyle=l,c.fillRect(p.x,p.y-10,-e,20)}c.globalCompositeOperation="source-over"},boosterYRender=function(){var e=random(50,150);if(c.globalCompositeOperation="lighter",playerUpKey){var l=c.createLinearGradient(p.x-10,p.y,p.x+10,p.y+e);l.addColorStop(0,"rgba(255,255,255,1)"),l.addColorStop(1,"rgba(0,0,255,0)"),c.fillStyle=l,c.fillRect(p.x-10,p.y,20,e)}if(playerDownKey){var l=c.createLinearGradient(p.x-10,p.y,p.x+10,p.y-e);l.addColorStop(0,"rgba(255,255,255,1)"),l.addColorStop(1,"rgba(0,0,255,0)"),c.fillStyle=l,c.fillRect(p.x-10,p.y,20,-e)}c.globalCompositeOperation="source-over"},boundaryWrap=function(){p.x>canvas.width+p.r&&(p.x=0-p.r),p.x<0-p.r&&p.xVel<0&&(p.x=canvas.width),p.y>canvas.height&&(p.y=0-p.r),p.y<0-p.r&&p.yVel<0&&(p.y=canvas.height)},playerUpdate=function(){if(playerAlive&&playerLives>0){boundaryWrap(),p.x+=p.xVel/dilationFactor,p.y+=p.yVel/dilationFactor;for(var e=(p.x-100,p.x+100,p.y-100,p.y+100,asteroidsL.length-1);e>=0;e--){aL=asteroidsL[e];var l=dist(p.x,p.y,aL.x,aL.y),r=p.r+aL.r;r>=l&&(colPointX=aL.x,colPointY=aL.y,p.x=null,p.y=null,thisTime=counter,playerCollision=!0,playerLives-=1,playerAlive=!1,asteroidsL.splice(e,1),makeAsteroidS(10),makeExplosions(1),scoreMultiplier=1,multiplierTarget=10,firingCooldown=10,bulletSpeed=20)}for(var e=asteroidsS.length-1;e>=0;e--){aS=asteroidsS[e];var l=dist(p.x,p.y,aS.x,aS.y),r=p.r+aS.r;r>=l&&(colPointX=aS.x,colPointY=aS.y,p.x=null,p.y=null,thisTime=counter,playerCollision=!0,playerLives-=1,playerAlive=!1,asteroidsS.splice(e,1),makeExplosions(1),scoreMultiplier=1,multiplierTarget=10,firingCooldown=10,bulletSpeed=20)}}playerCollision&&playerLives>0&&counter-thisTime>=120&&(playerAlive=!0,playerCollision=!1,p.x=canvas.width/2,p.y=canvas.height/2,p.xVel=0,p.yVel=0),0>=playerLives&&(gameOver=!0,startGame=!1)},playerAimRender=function(){c.lineWidth=1,c.strokeStyle=rgb(0,0,255),c.strokeCircle(mouseX,mouseY,20),c.beginPath(),c.moveTo(mouseX,mouseY-10),c.lineTo(mouseX,mouseY-30),c.stroke(),c.beginPath(),c.moveTo(mouseX,mouseY+10),c.lineTo(mouseX,mouseY+30),c.stroke(),c.beginPath(),c.moveTo(mouseX-10,mouseY),c.lineTo(mouseX-30,mouseY),c.stroke(),c.beginPath(),c.moveTo(mouseX+10,mouseY),c.lineTo(mouseX+30,mouseY),c.stroke()},bullets=[],currGameState=!1,resultX,resultY,asteroidsL=[],asteroidsS=[],powerUps=[],scoreText=[],explosions=[],bgStars=[],initGame=function(){score=0,startGame=!1,gameOver=!1,populateAsteroids=!0,playerAlive=!0,playerCollision=!1,playerLives=3,p.x=canvas.width/2,p.y=canvas.height/2,p.yVel=0,p.xVel=0,gT.colA=1,asteroidsL.length=0,asteroidsS.length=0,explosions.length=0,bullets.length=0},gameOverText={colR:255,colG:255,colB:255,colA:1,font:"50pt arial",x:canvas.width/2,y:canvas.height/2,align:"center"},gT=gameOverText,gameOverAnim=function(){gameOver&&(startGame=!1,c.font=gT.font,c.fillStyle=rgba(gT.colR,gT.colG,gT.colB,gT.colA),c.textAlign=gT.align,c.fillText("GAME OVER",gT.x,gT.y),c.font="50pt arial",c.fillText("SCORE: "+score,gT.x,gT.y+120),gT.colA-=.005,counter%240==0&&($(".startButton.off").removeClass("off").addClass("on"),$(".playerControls.off").removeClass("off").addClass("on"),initGame()))},debugOutput=function(){c.textAlign="center",c.font="20pt arial",c.fillStyle="#ccc",c.fillText("score "+score,canvas.width/2,50),c.fillText("multiplier "+scoreMultiplier,canvas.width/2-200,50),c.fillText("playerLives "+playerLives,200,50),c.fillText("warp "+dilationAmount,150,200),c.fillText("dilationSwitch "+dilationSwitch,150,250),c.fillText("firingCooldownTotal "+firingCooldownTotal,150,300),c.fillText("currBullets "+currBullets,150,350),gameTime=parseInt((counter-powerUpThisTime)/60,10),c.fillText("gameTime "+gameTime,300,canvas.height-50)};